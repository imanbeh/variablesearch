import pandas as pd

'''
cd /Users/iman/Documents/amnh_rsch/47project/flcs/
Set up data on each file
'''

# Star coordindates

star1coords = [(3179.3993,1090.9057),
(3125.5164,1035.5586),
(2961.7117,3135.5125),
(2962.0571,3136.7795),
(2033.1369,2596.2611),
(2033.2484,2597.2105),
(1842.9865,1759.526),
(1843.468,1760.0272),
(2912.9577,1026.0737),
(2945.4805,1086.2451),
(2874.8546,964.02501),
(2939.3782,1080.1755),
(3125.111,995.23808),
(3127.4887,993.96358),
(3125.2292,995.47492),
(3212.5344,1465.363),
(3791.971,1648.6858),
(4435.4298,1774.5935),
(3302.3117,1501.7442),
(3380.9988,2184.2214),
(3379.9849,2184.721),
(3380.6055,2184.9531),
(3381.2852,2183.9304),
(3380.9983,2185.1677),
(3380.9064,2184.8614),
(3380.7289,2183.9851),
(3380.6783,2184.7257),
(3380.2628,2184.9814),
(3850.7233,1873.9471),
(3850.3799,1872.9965)]

star2coords = [(3205.2918,1082.2619),
(3151.7966,1026.6435),
(2988.0694,3125.8221),
(2988.221,3128.0582),
(2058.9132,2587.1522),
(2059.2185,2588.4892),
(1870.3132,1750.0295),
(1869.4381,1751.4997),
(2938.9278,1017.5462),
(2971.8382,1077.33),
(2901.0185,955.49752),
(2965.5421,1071.8418),
(3151.4687,986.90439),
(3152.6835,980.00949),
(3151.5869,986.55981),
(3238.8921,1456.6417),
(3817.9411,1640.5459),
(4461.3999,1766.6474),
(3328.2818,1493.4105),
(3406.9689,2175.8877),
(3406.1489,2176.5811),
(3406.9632,2176.8132),
(3407.2553,2175.7906),
(3406.9684,2176.4464),
(3406.6827,2176.7215),
(3406.8928,2175.8452),
(3406.4546,2176.392),
(3406.4267,2176.6477),
(3876.6934,1865.2258),
(3876.5438,1864.6628)]

star3coords = [(3184.8258,1058.3849),(3131.5631,1002.7666),(2996.9457,3093.8441),(2996.8648,3094.6847),
(2067.6732,2554.3601),(2067.7847,2555.1545),(1878.143,1717.1987),(1878.0044,1717.9324),(2947.2615,984.36649),
(2980.2107,1044.1115),(2909.3522,921.85269),(2974.3409,1038.6234),(3160.9652,953.60841),(0,0),
(3160.7346,953.22508),(3247.6522,1423.8109),(3826.5943,1607.2237),(4469.9757,1733.2089),(3336.7706,1460.1146),
(3415.4669,2142.0615),(3414.7538,2143.2851),(3415.2581,2143.5947),(3415.5595,2142.9722),(3415.6122,2142.414),
(3415.559,2142.8441),(3415.8171,2142.2516),(3415.0596,2143.096),(3415.7681,2143.6231),(3885.027,1832.7438),
(3885.9241,1831.987)]

star4coords = [(3142.2659,1057.9198),(3088.3055,1002.3014),(2924.6171,3102.2165),(2924.7687,3103.7548),
(1996.0423,2562.9651),(1996.1538,2563.9921),(1806.2795,1726.0362),(1806.1409,1727.0025),(2875.6306,992.9715),
(2908.1146,1052.9491),(2837.4887,931.15541),(2902.2449,1047.2284),(3088.404,962.21343),(0,0),
(3088.1734,962.06266),(3175.5561,1432.4159),(3754.2657,1616.2938),(4398.1123,1742.7442),(3264.9071,1468.487),
(3343.3709,2151.3643),(3342.8904,2151.6576),(3343.1621,2151.9672),(3343.696,2151.5772),(3343.5161,2151.7167),
(3343.4629,2151.6817),(3343.4885,2151.0892),(3343.1961,2151.701),(3343.207,2152.2281),(3813.3961,1840.8837),
(3812.8977,1839.8943)]
coords = [(3185.3582,1072.7999),(3132.0568,1016.9877),(2968.7174,3116.9415),(2968.4814,3118.4023),
          (2040.5306,2577.6898),(2039.4792,2578.6393),(1849.6051,1740.9546),(1849.6991,1741.262),
          (2919.188,1007.5028),(2951.9046,1067.2866),(2881.2787,945.4541),(2945.8023,1061.7984),
          (3131.7289,977.2486),(3133.719,975.97409),(3131.8471,976.51642),(3219.1523,1447.1798),
          (3798.2495,1630.9026),(0,0),(0,0),(0,0),(4441.7084,1756.4227),(3307.9607,1483.3671),
          (0,0),(0,0),(3387.0834,2165.663),(3386.6029,2166.3439),(3386.642,2166.576),(3387.3698,2165.9535),
          (3387.0348,2166.403),(3387.1367,2166.2905),(3387.3948,2165.8143),(3386.9086,2166.1548),
          (3386.6869,2166.4105),(3857.1474,1855.3762),(3856.8041,1854.6194)]
# More file information

files = ["IBJ203010", "IBJ204010", "IBY403030", "IBY403040", "IBY404030",
        "IBY404040", "IBY405030", "IBY405040", "IC2R01040", "IC2R01050",
        "IC2R02040", "IC2R02050", "ID5V02010", "ID5V02020", "ID5V02030",
        "ID5V04010", "J6LL01010", "J6LL01YGQ", "J6LL01YIQ", "J6LL01YKQ",
        "J8CD01010", "J8DM02010", "J8DM02F6Q", "J8DM02F8Q", "J8FW01010",
        "J8FW01020", "J8FW01030", "J8FW02010", "J8FW02020", "J8FW02030",
        "J8FW03010", "J8FW03020", "J8FW03030", "J9L960010", "J9L960020"]

exp = [2411, 2411, 1080, 1205, 1080, 1205, 1080, 1205, 2312, 7288,
        2312, 7288, 2868, 2980, 2980, 2868, 450, 150, 150, 150, 900,
        270, 340, 340, 300, 465, 2630, 310, 455, 2630, 345, 400, 2180,
        203, 203]

dates = ["2010-11-22 18:41:22", "2010-11-21 15:58:59","2013-01-24 7:04:58","2013-01-24 7:27:40","2013-02-26 5:31:03",
        "2013-02-26 6:58:58","2013-04-09 23:36:17","2013-04-09 23:58:59","2013-08-13 2:09:38","2013-08-13 3:13:57",
        "2013-08-13 6:44:34","2013-08-13 7:48:53","2017-08-27 15:55:29","2017-08-27 17:23:25","2017-08-27 18:59:45",
        "2017-01-31 2:20:38","2002-07-07 20:28:52","2002-07-07 22:18:18","2002-07-07 22:29:43","2002-07-07 22:40:43",
        "2002-04-05 14:24:00","2003-01-08 20:26:09","2003-01-08 20:59:19","2003-01-08 21:07:37","2002-09-30 3:01:19",
        "2002-09-30 1:35:02","2002-09-30 1:38:58","2002-10-02 22:18:11","2002-10-02 20:46:55","2002-10-02 20:50:51",
        "2002-10-11 8:27:42","2002-10-11 2:15:56","2002-10-11 6:32:19","2006-03-13 1:42:25","2006-03-13 3:31:31"]

filters = [275, 275, 225, 336, 225, 336, 225, 336, 390, 300, 390,300,665,680,665,665,475,555,435,814,475, 550,502,
658,435,625,658,435,625,658,435,625,658,606,814]

mags = [23.8555995 , 24.61626448, 21.31177231, 25.06082921, 23.18050736,
       25.56191154, 22.01971833, 22.07056471, 25.28939548, 24.25148752,
       23.33884649, 24.1586587 , 25.06796917, 22.29252809, 21.24411703,
       25.7193792 , 22.97716536, 22.59466587, 22.97715502, 25.10152658,
       23.98067261, 24.08563375, 27.30618615, 24.68290921, 25.80494501,
       24.84400343, 23.46703501, 24.45213284, 26.45981916, 24.55275089,
       27.60861843, 26.59912793, 24.56330037, 24.66767279, 26.04488764]


# set up dataframe
df = pd.DataFrame({"Filename": files, "Filter nm": filters, "Times": dates,"Coordinates": coords, "Magnitude": mags, "Exposure": exp})
df.sort_values(by=['Filter nm'], ascending=True, inplace=True)
df['Filename'][0]
# drop files lacking data
df.drop([17, 18, 19, 22, 23], inplace = True)
df.sort_values(by=['Filename'], ascending=True, inplace=True)
# add star coordinates for stars 1-4
df['Star 1'] = star1coords
df['Star 2'] = star2coords
df['Star 3'] = star3coords
df['Star 4'] = star4coords
df = df.drop([13])

from astropy.time import Time
from datetime import datetime

t1 = Time(df['Times'].to_list(),format = 'iso')
df['Time as Object']=t1.tt.datetime
df['Day'] = [t.datetime.day for t in t1]
df.sort_values(by = 'Filter nm', inplace = True)




# setup for file access
import os
from astropy.io import fits

drc =[0]*len(files)
len(drc)
for i in range(len(files)):
    key = str(files[i])
    drc[i] = fits.open("/Users/iman/Documents/amnh_rsch/47Tuc2c1/" + files[i] + '_drc.fits')





l = {}
for folder in files: 
    l[folder] = os.listdir('/Users/iman/Documents/amnh_rsch/47project/flcs/' + folder)
basePath = '/Users/iman/Documents/47project/flcs/'

lopen = []
sts = []

for key in l.keys():
    l2 = []
    for i in l[key]:
        st = basePath + key + '/' + i
        print(st)
        l2.append(basePath + key + '/' + i)
        #lopen.append(fits.open(st))
    
    sts.append(l2)
    
datas = []
names = []
hdus=[]
headers=[]
count = 0
for i in range(len(l)):
    if (len(sts[i])!=1):
        if(list(l.keys())[i]!='J6LL01YGQ')&(list(l.keys())[i]!='ID5V02020'):
            print(count, list(l.keys())[i])
            names.append(list(l.keys())[i])
            cutpath = '/Users/iman/Documents/amnh_rsch/47project/drcs/' + list(l.keys())[i] + '_final_drc_sci.fits'
            hdus.append(fits.open(cutpath))
            headers.append(hdus[count][1])
            datas.append(fits.getdata(cutpath))
            datas[count] += 1
            count+=1